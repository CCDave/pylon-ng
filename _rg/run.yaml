_env:
    - !R.env
        _name : "dev"
        _res  :
            - !R.vars
                # PRJ_ROOT    : "${HOME}/devspace/pylon"
                DOMAIN      : "api.pylon360.com"
    - !R.env
        _name : "online"
        _res  :
            - !R.vars
                PRJ_ROOT    : "/home/x/php/pylon2_doc"
                DOMAIN      :  "api.pylon360.com"
    - !R.env
        _name : "os54"
        _res  :
            - !R.vars
                OS_VER      : "centos-5.4-64.bit"
    - !R.env
        _name : "php53"
        _res  :
            - !R.vars
                PHP_VER     : "5.3"
                PHP_VER_TAG : "53"
                PHP_INI_TPL : "tpl_web_php.ini"
    - !R.env
        _name : "php56"
        _res  :
            - !R.vars
                PHP_VER     : "5.6"
                PHP_VER_TAG : "56"
                PHP_INI_TPL : "tpl_web_php_56.ini"
    - !R.env
        _name : "pylon"
        _res  :
            - !R.vars
                PYLON_MVER  : "30"

    - !R.env
        _name : "base"
        _res  :
            - !R.project
                name : "pylon"
                root : "${HOME}/devspace/pylon-ng"

            - !R.vars
                PYLON       : "${PRJ_ROOT}/src"
                DB_HOST   : "127.0.0.1"
                DB_USER   : "dev"
                DB_PWD    : ""
                DB_NAME   : "pylon_${USER}"
                PHP_ERROR : "E_ALL & ~E_NOTICE"

                EXT_VER  : "30"
                EXT_NAME : "pylon"
                EXT_TAG  : "${EXT_VER}-${PHP_VER}"
                FULL_EXT : "${EXT_NAME}_${EXT_TAG}.so"
            - !R.path
                dst: "${PRJ_ROOT}/conf/used/"
            - !R.path
                dst: "${PRJ_ROOT}/tmp"


_sys:
    - !R.system
        _name: "smasher"
        _res :
                - !R.vars
                    OS_VER   : "centos-6.6"
                - !R.path
                    dst    : "${PRJ_ROOT}/smasher/conf/used"
                - !R.file_tpl
                    tpl    : "${PRJ_ROOT}/smasher/conf/options/php.ini"
                    dst    : "${PRJ_ROOT}/smasher/conf/used/php.ini"

                - !R.shell
                    script : "${PRJ_ROOT}/smasher/build.sh"
                - !R.shell
                    script : "${PRJ_ROOT}/smasher/build_phpext.sh"

                - !R.php
                    bin    : "/usr/local/php-${PHP_VER}/bin/php"
                    ini    : "${PRJ_ROOT}/smasher/conf/used/php.ini"
                    script : "${PRJ_ROOT}/smasher/test/ext/pylon_test.php"

                - !R.copy
                    src    : "${PRJ_ROOT}/smasher/bin/${FULL_EXT}"
                    dst    : "${PRJ_ROOT}/src/modules/${OS_VER}/${PHP_VER}/${FULL_EXT}"
                    run    : "start"

    - !R.system
        _name: "demo"
        _res :
                - !R.vars
                    APP_SYS       : "demo"
                    RUN_PATH      : "${PRJ_ROOT}/run/demo"
                    DOMAIN        : "${USER}.demo.pylon360.com"
                    SOCK_FILE     : "${RUN_PATH}/fpm.sock"
                    AUTOLOAD_PATH : "${PYLON}/:/home/x/php/svc_utls:/usr/local/php/lib/php/"


                - !R.echo
                    value         : "${RUN_PATH}"
                - !R.pylon_autoload
                    include       : "${PYLON}"
                - !R.pylon_router
                    include       : "${PRJ_ROOT}/demo/"
                - !R.fpm
                    ini_tpl       : "${PRJ_ROOT}/conf/options/tpl_web_php_56.ini"
                    conf_tpl      : "${PRJ_ROOT}/conf/options/fpm.conf"
                    sudo          : True

                - !R.nginx_conf
                    tpl:  "${PRJ_ROOT}/conf/options/tpl_demo_ngx.conf"
                    src:  "${PRJ_ROOT}/conf/used/demo_ngx.conf"
                    sudo: True

    - !R.system
        _name : "test"
        _res  :
            - !R.vars
                OS_VER   : "centos-6.6"
                PHP_INI       : "${PRJ_ROOT}/test/pylon/config/used/php_test.ini"
                ASSEMBLY      : "test_assembly"
            - !R.path
                dst           : "${PRJ_ROOT}/test/pylon/config/used/"
            - !R.file_tpl
                tpl           : "${PRJ_ROOT}/test/pylon/config/options/php_tpl.ini"
                dst           : "${PHP_INI}"
            - !R.file_tpl
                tpl           : "${PRJ_ROOT}/test/pylon/config/options/conf_tpl.php"
                dst           : "${PRJ_ROOT}/test/pylon/config/used/config_test.php"

            - !R.pylon_autoload
                include: "${PRJ_ROOT}/src/pylon:${PRJ_ROOT}/test/pylon:/usr/local/php/lib/php/"
    #
    #         - !R.mysql
    #             host          : "${DB_HOST}"
    #             name          : "${DB_NAME}"
    #             user          : "${DB_USER}"
    #             password      : "${DB_PWD}"
    #             root          : "dev"
    #             rootpwd       : "${DB_PWD}"
    #             allow_addr    : "127.0.1.%"
    #             sql           : "${PRJ_ROOT}/test/pylon/datainit/create_db.sql"
    #
    #         - !R.phpunit2
    #             bin           : "/usr/local/php/bin/phpunit"
    #             path          : "test/pylon"


    # college: !R.system2
    #     res:
    #             - !R.vars
    #                 APP_SYS       : "college"
    #                 DOMAIN        : "${USER}.pylon360.com"
    #                 AUTOLOAD_PATH : "${PYLON}/:${PRJ_ROOT}/college"
    #                 RUN_PATH      : "${PRJ_ROOT}/run/college"
    #             - !R.rest
    #                 src           : "${PRJ_ROOT}/college/"
    #             - !R.using
    #                 refs          :
    #                     - *m_nginx
    #                     - *m_phpcgi
